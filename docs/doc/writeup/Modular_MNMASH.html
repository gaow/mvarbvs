<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />
<title>Modular_MNMASH</title><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>








<!-- Custom stylesheet, it must be in the same directory as the html file -->
<link rel="stylesheet" href="custom.css">

<!-- Loading mathjax macro -->
<!-- Load mathjax -->
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    <!-- End of mathjax configuration --></head>

 <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js"></script>

<style>  /* defined here in case the main.css below cannot be loaded */
.lev1 {margin-left: 80px}
.lev2 {margin-left: 100px}
.lev3 {margin-left: 120px}
.lev4 {margin-left: 140px}
.lev5 {margin-left: 160px}
.lev6 {margin-left: 180px}
</style>


<link rel="stylesheet" type="text/css" href="../../css/jt.css">
<link rel="stylesheet" type="text/css" href="../../css/toc2.css">

<script src="../../js/toc2.js"></script>
<script src="../../js/docs.js"></script>

<script>
    MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
        },
        "HTML-CSS": {
            preferredFont: "TeX",
            availableFonts: ["STIX","TeX"],
            styles: {
                scale: 110,
                ".MathJax_Display": {
                    "font-size": "110%",
                }
            }
        }
    });
</script>

<script>
$( document ).ready(function(){

            var cfg={'threshold':3,     // depth of toc (number of levels)
             'number_sections': false,  // sections numbering
             'toc_cell': false,          // useless here
             'toc_window_display': true, // display the toc window
             "toc_section_display": "block", // display toc contents in the window
             'sideBar':true,       // sidebar or floating window
             'navigate_menu':false       // navigation menu (only in liveNotebook -- do not change)
            }

            var st={};                  // some variables used in the script
            st.rendering_toc_cell = false;
            st.config_loaded = false;
            st.extension_initialized=false;
            st.nbcontainer_marginleft = $('#notebook-container').css('margin-left')
            st.nbcontainer_marginright = $('#notebook-container').css('margin-right')
            st.nbcontainer_width = $('#notebook-container').css('width')
            st.oldTocHeight = undefined
            st.cell_toc = undefined;
            st.toc_index=0;

            // fire the main function with these parameters


            table_of_contents(cfg,st);


            var file=writeupDict[$("h1:first").attr("id")];
            $("#toc-level0 a").css("color","#126dce");
            $('a[href="#'+$("h1:first").attr("id")+'"]').hide()
            
            var tuts=writeup;
            var pos=writeup.indexOf(file);
        
            for (var a=pos;a>=0;a--){
                  var name=tuts[a]
                  $('<li><a href="'+name+'.html">'+name.replace(/_/g," ")+'</a></li>').insertBefore("#toc-level0 li:eq(0)");
            }
            $('a[href="'+file+'.html'+'"]').css("color","#126dce");

            $('<li id="indexHome"><a href="../../writeup.html"><b>Writeup Home<b></a></li>').insertBefore("#toc-level0 li:eq(0)");
            for (var a=pos+1;a<tuts.length;a++){
                  var name=tuts[a]
                  $(".toc #toc-level0").append('<li><a href="'+name+'.html">'+name.replace(/_/g," ")+'</a></li>');
            }
            $("#toc-header").hide();


    });
</script>
<body>
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="A-modular-approach-to-M&amp;M-ASH-model">A modular approach to M&amp;M ASH model<a class="anchor-link" href="#A-modular-approach-to-M&amp;M-ASH-model">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Motivation">Motivation<a class="anchor-link" href="#Motivation">&#182;</a></h2><p>In genetic association studies there is great interest in finding multiple causal variants (eQTL or GWAS hits). Several methods for fine mapping in univariate association problems (eg, eQTL discovery with single tissues) have been developed, but for multi-condition analysis this problem is more difficult to address. <a href="http://dx.doi.org/10.1016/j.ajhg.2016.03.029">DAP (Wen 2016)</a> uses an MCMC based method (DAP) for fine mapping but it lacks a principled approach to combine genome-wide information to estimate hyperparameters required by the algorithm, due to computational limitations.</p>
<p>On the other side of the coin, linkage Disequilibrium (LD) can impact effect estimates in association analysis. In the case of univariate regression (snp-by-snp analysis) LD causes effect size estimates not of the true effect of each SNP, but the "LD-convolved" effect that essentially is the combined effect (the sum) of all SNPs in LD with the SNP of interest. So not only are these estimates correlated but more fundamentally they are not consistent estimate of multiple regression (multiple SNP per phenotype) coefficients, when there are indeed more than one causal variant for the condition of interest. The same argument can be generalized to conventional multivariate regression.</p>
<p>A particular type of multivariate regression, the <a href="http://dx.doi.org/10.1101/096552">mash (Urbut 2016)</a> paper that uses summary statistics from simple regression is also influenced in the same manner. By taking LD-convoluted effect size estimate as input, the resulting output of mash is not consistent estimate of "the truth" (ie, if all SNPs are typed, then in the absence of population structure a multiple-SNP regression estimate can be interpreted as the causal effects), and our application of mash in GTEx data discovered eQTLs having opposite direction of effect size in brain vs non-brain tissues. However we suspect this is more likely due to multiple eQTLs in negative LD that the current mash procedure failed to account for, rather than true effects being negative.</p>
<p>So we attempt to fix both problems with the M&amp;M ASH model, or m&amp;m for short hereafter. We have developed with <a href="https://github.com/gaow/mvarbvs/tree/master/analysis/writeup/identity_cov">m&amp;m assuming identity covariance</a> and <a href="https://github.com/gaow/mvarbvs/tree/master/analysis/writeup/lr_diag_cov">m&amp;m assuming diagonal plus low rank covariance</a>, along with a very first draft <a href="https://github.com/gaow/mnmashr">implementation</a>, based on the variational inference framework similar to <a href="http://stephenslab.uchicago.edu/assets/papers/Carbonetto2012.pdf">varbvs (Carbonatto 2012)</a> and <a href="https://github.com/stephenslab/mvash">mr-ash</a> to hand issues with LD, yet in the multivariate notation that fits into the mash mixture model. At the same time there are other potentially connected work in the lab including <a href="http://dx.doi.org/10.1101/042457">rss (Zhu 2016)</a>, which can be extended to the summary statistics version of mr-ash, and BMASS (Turchin), which can be considered a special case of mash (if we are willing to use known residual covariance matrix). Building m&amp;m from scratch already involves implementing varbvs / mr-ash and mash as special cases; adding other special cases to m&amp;m seems overly ambitious, and may result in a monster (rather than master!) algorithm / software that claims to do everything yet excels in nothing (in terms of performance) compared to existing individual pieces that have already been carefully designed, well engineered, extensively tested and properly documented<code>*</code>. Therefore we want to adopt a modular design to m&amp;m that harnesses, rather than reinvent, all related Stephens lab work.</p>
<p><code>*</code> <em>one aspect the monster algorithm is surely to suffer is that the mixture components has to be initialized up-front, that means it has to be computed with LD-convoluted effect size estimates. But the modular approach will not have the problem.</em></p>
<p>The modular m&amp;m should work as follows:</p>
<ol>
<li>Estimate deconvoluted effect size for each condition</li>
<li>Use 1 to perform mash to obtain hyperparameters (mixture proportions) at genome level</li>
<li>Trait analysis units (genes, LD blocks) independent and use prior from 2 to initialize multivariate fine mapping method such as DAP.</li>
</ol>
<h2 id="Step-one:-deconvoluted-effect-size-estimation">Step one: deconvoluted effect size estimation<a class="anchor-link" href="#Step-one:-deconvoluted-effect-size-estimation">&#182;</a></h2><p>The goal here is to obtain LD-deconvoluted effect size estimates for each condition separately (univariate analysis). This is a variable selection problem that can be addressed with a number of existing methods but we'll use mr-ash because 1) the idea of ASH is powerful and 2) the variational EM algorithm (VEM) is efficient.</p>
<p>There is identifiability problem with mr-ash because VEM will converge to local optima and the effect size it reports for the SNP identified may not be the causal SNP. But it is irrelevant because as previously mentioned we'll take a hybrid approach, ie, use VEM to estimate hyperparameters, and condition MCMC on these hyperparameter estimates to perform fine-mapping with these hyperparameters. It is in fact advantageous to use VEM at this stage -- as precursor to mash we would prefer sparse solution (via VEM) rather than averaged solution (via MCMC), because sparsed mode is more representative than mean of modes.</p>
<p>However we do have to ensure that each of mr-ash analysis on different conditions will give the same sparse mode. One way to ensure this is to assume effects across all conditions are the same and fit a fixed effect model, using estimates from there to initialize mr-ash hoping the VEM converge to the same mode this way. But Wei has pointed out that VEM computation always favors $X_1$ in the block of $X_1, ..., X_p$, thus as long as the order of $X$ remains the same across univariate analysis we should be good.</p>
<p>Another issue to verify is that the hyperparameters $\mathbf{\pi}$ obtained via running ash on effect size estimates from mr-ash agrees with those estimated from mr-ash. If this is verified, we can claim that the hyperparameters estimated by mash using mr-ash deconvoluted data is equivalent to fitting the monster algorithm.</p>
<p>Also, instead of using posterior mean of $\beta$ from mr-ash, we should use likelihood:</p>
$$P(Y|\beta_1) \propto \frac{P(\beta_1|Y)}{P(\beta_1)}$$<p>where $P(\beta_1)$ is available from the VEM updates.</p>
<h2 id="Step-two:-multivariate-analysis-on-deconvoluted-effect-size-estimates">Step two: multivariate analysis on deconvoluted effect size estimates<a class="anchor-link" href="#Step-two:-multivariate-analysis-on-deconvoluted-effect-size-estimates">&#182;</a></h2><p>We use mash to perform another shrinkage in order to learn typical patterns of sparsity, sharing and correlations among effects, and pass this knowledge to the next step. First, as with mash we initialize $U_k$ using a number of decompositions on covariance matrix of effect size. But I'm not sure about:</p>
<ol>
<li>Do we use posterior mean from mr-ash?</li>
<li>Do we still take the "top SNP" per unit (gene) across conditions?</li>
</ol>
<p>Will follow this up on github.</p>
<p>Then we estimate $U_k$ via some deconvolution method (Bovy or Gerard), use the result in the mixture prior and write up the likelihood of $\hat{\beta}$ to feed into the algorithm for mixture proportion estimation (a convex problem). I'm not sure how to directly incorporate likelihood from mr-ash, rather than output data ($\hat{\beta}$ and se($\hat{\beta}$)), to calculate mash likelihood. Maybe this is self-evident when we write the model. Will follow it up on github.</p>
<h2 id="Step-three:-fine-mapping-for-eQTL-discovery">Step three: fine-mapping for eQTL discovery<a class="anchor-link" href="#Step-three:-fine-mapping-for-eQTL-discovery">&#182;</a></h2><p>To generate posterior mean of effect size -- the fine-mapping. DAP can be applied in parallel to all units using the same prior from previous step. I still have to read about it.</p>
<h2 id="What-to-do-with-mr-ash?">What to do with <code>mr-ash</code>?<a class="anchor-link" href="#What-to-do-with-mr-ash?">&#182;</a></h2><p>This is a separate topic from m&amp;m yet it is important because mr-ash is the first step in m&amp;m. Currently we have these verions of mr-ash:</p>
<ul>
<li>Full data versions:<ul>
<li>matlab version (varbvs by Peter)</li>
<li>R version (mvash by Wei)</li>
<li>R/C++ version (a special case of mnmashr by Gao)</li>
</ul>
</li>
<li>Summary data version:<ul>
<li>matlab version (rss by Xiang)</li>
<li>R version (by Nick)</li>
</ul>
</li>
</ul>
<p>For the full data version we'll consolidate our efforts to <code>varbvs</code> package. I had a conversation with Peter: it is not hard, according to him, to come up with an R/C version that fits in the varbvs engineering framework. As a first pass m&amp;m will start from full data, because we do have the luxury to access individual level GTEx data and for eQTL problem the scale of computation per gene is not big enough to induce the need of approximating $X^TX$ with banded structure and use summary version of mr-ash.</p>
<p>As for where mr-ash paper goes, we've previously agreed to write it up as an extension to the large scale BVS problem using adaptive shrinkage prior, and to provide better estimate of effect size distribution due to "adaptive" (meaning better) shrinkage. It is more interesting to make a non-trivial application in the paper than to just focus on selling the method part. Xiang Zhu is planning on performing effect size distribution estimation using summary data. We'd like to apply mr-ash on traits in UK Biobank data to provide the community a proper GWAS analysis which by itself would be a great application but using mr-ash for it makes it even greater!</p>
<h2 id="Next-action-items">Next action items<a class="anchor-link" href="#Next-action-items">&#182;</a></h2><p>Will discuss it on github.</p>

</div>
</div>
</div>
    </div>
  </div>
</body>

 


</html>
